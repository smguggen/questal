const squire={Util:class{constructor(){}static getType(e){return e instanceof RegExp?"regex":"object"==typeof e?squire.Util.getObjectType(e):typeof e}static typecheck(e,t){var s;switch(t=t||"string"){case"array":s=Array.isArray(e);break;case"object":s="object"==typeof e&&null!=e&&!Array.isArray(e);case"regex":s=e instanceof RegExp;break;case"null":s=!e;case"undefined":case"false":break;case"true":s=!!e;break;default:s=typeof e===t}return!!s}static getObjectType(e){return"object"==typeof e&&(null==e?"null":Array.isArray(e)?"array":"object")}},Event:class{constructor(e){e=e||[],this.eventNames=["init","send","change","complete","success","progress","abort","error","timeout"].concat(e),this.events=this.eventNames.reduce((e,t)=>(e[t]=[],e),{})}on(e,t){return this.event=e,this.events[e].push(t),this}fire(e){let t=this;if(!this.events[e]||!this.events[e].length)return;let s=this.events[e];for(let e=0;e<s.length;e++){s[e].call(t)}return this}set event(e){this.eventNames.includes(e)||this.eventNames.push(e),this.events[e]||(this.events[e]=[])}get complete(){return this._getTemplate("complete")}get change(){return this._getTemplate("change")}get progress(){return this._getTemplate("progress")}get error(){return this._getTemplate("error")}get abort(){return this._getTemplate("abort")}get success(){return this._getTemplate("success")}get init(){return this._getTemplate("init")}get timeout(){return this._getTemplate("timeout")}_getTemplate(e){let t=this;return!!(this.eventNames.includes(e)&&this.events[e]&&this.events[e].length)&&(()=>{t.fire(e)})}},Data:class{constructor(){}set data(e){this.setData(e)}set params(e){this.setData(e)}get data(){return this._data||{}}get params(){return this._params||""}setData(e){this._data||(this._data={}),this._params||(this._params="");let t={},s="",r=squire.Util.getType(e);"object"==r?(t=e,s=this.parseParamsToString(e)):"string"==r&&(t=this.parseParamsToObject(e),s=e),this._data=Object.assign({},this._data,t),this._params+=s}parseParamsToObject(e){return"?"==(e=e||"").substring(0,1)&&(e=e.substring(1)),e.split("&").reduce((e,t)=>{let s=t.split("=");return e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]),e},{})}parseParamsToString(e,t){return e=e||{},(t?"?":"")+Object.keys(e).reduce((t,s)=>t+=encodeURIComponent(params)+"="+encodeURIComponent(e[s]),"").join("&")}},Header:class{constructor(e){this.sender=e,this.headers={}}set accept(e){let t;switch(this._accept||(this._accept=[]),e){case"json":t="application/json";break;case"html":t="text/html";break;case"xml":t="application/xml, application/xhtml+xml";break;case"plain":t="text/plain";break;default:t=e}"*/*"==t?this._accept=["*/*"]:this._accept.includes(t)||this._accept.push(t)}get accept(){return this._accept||(this._accept=[]),this._accept.includes("*/*")?"*/*":this._accept.join(",")}set encoding(e){let t=this;switch(e){case"multipart":t.encoding="multipart/form-data";case"form":break;case"plain":t.encoding="text/plain";break;default:t.encoding="application/x-www-form-urlencoded"}}get encoding(){return this._encoding?this._encoding:"application/x-www-form-urlencoded"}set(e,t){return"accept"==e.toLowerCase()?this.accept=t:"encoding"==e||"Content-Type"==e?this.encoding=t:this.isForbidden(e)||(this.headers[e]=t),this}init(){let e=Object.keys(this.headers);for(let t=0;t<e.length;t++){let s=e[t],r=this.headers[s];this.isForbidden(s)||this.sender.setRequestHeader(s,r),this.accept&&this.sender.setRequestHeader("Accept",this.accept),this.encoding&&this.sender.setRequestHeader("Content-Type",this.encoding)}return this}isForbidden(e){if((e=e.trim()).startsWith("Sec-")||e.startsWith("Proxy-"))return!0;return!!["Accept-Charset","Accept-Encoding","Access-Control-Request-Headers","Access-Control-Request-Method","Connection","Content-Length","Cookie","Cookie2","Date","DNT","Expect","Host","Keep-Alive","Origin","Referer","TE","Trailer","Transfer-Encoding","Upgrade","Via"].includes(e)}},Response:class{constructor(e){this.sender=e,this.defaultType="text",this.types=["arraybuffer","blob","document","text","json"]}get data(){let e=this.type;this.type="json";let t=this.sender.response;return this.type=e,t}get url(){return this.sender.responseURL}get result(){let e=this.sender.responseText;try{return JSON.parse(e)}catch(t){return e}}get xml(){return this.sender.responseXML}get html(){return"document"==this.type?this.sender.responseXML:""}set type(e){e="buffer"==e?"arraybuffer":e,this.types.includes(e)&&(this._type=e,this.sender.responseType=e)}get type(){return this._type||this.defaultType}get status(){return this.sender.statusText}get code(){return this.sender.status}isSuccess(){return this.code>=200&&this.code<300}},Request:class{constructor(){this.sender=new XMLHttpRequest,this.events=new squire.Event,this.header=new squire.Header(this.sender),this.response=new squire.Response(this.sender),this.data=new squire.Data,this.onComplete()}set url(e){if(!squire.Util.typecheck(e))return;let t=e.split("?");this._url=t[0],t.length>1&&(this.data=t[1])}get url(){return this._url}set data(e){this.data.data=e}get data(){return this.data.data}get params(){return this.data.params}abort(){return this.sender.abort(),this}get(e){return this.sender[e]}set(e,t){let s=this;switch(e){case"credentials":s.sender.withCredentials=t;break;default:s.sender[e]=t}return this}on(e,t){this.events.eventNames.includes(e)&&this.events.on(e,t)}init(e,t,s){s=s||{};let r=Object.keys(s);for(let e=0;e<r.length;e++){let t=r[e];this.events.eventNames.includes(t)&&this.on(t,option[t])}this.events.fire("init"),this.set("timeout",s.timeout||6e4);let i=this.events.complete,n=this.events.progress,a=this.events.change,h=this.events.error,c=this.events.abort,o=this.events.timeout;return i&&this.set("onload",i),n&&this.set("onprogress",n),a&&this.set("onreadystatechange",a),h&&this.set("onerror",h),c&&this.set("onabort",c),o&&this.set("ontimeout",o),this.sender.open(e,t),this.events.fire("send"),this.sender.send(),this}onComplete(){let e=this;this.on("complete",()=>{e.response.isSuccess()&&e.events.fire("success")})}}};squire.Get=class extends squire.Request{constructor(){super()}get method(){return"get"}set method(e){}init(e,t){let s=this;t=t||{},this.url=e,this.data=t.data||{};let r=this.params?e+"?"+this.params:e;return this.on("send",()=>{let e=t.accept||["plain","xml","html"];s.header.accept=e,s.header.init()}),super.init(this.method,r,t)}static get(e,t,s){return(new squire.Get).init(e,t,s)}},squire.Post=class extends squire.Request{constructor(){super()}get method(){return"post"}set method(e){}init(e,t,s){let r=this;return this.url=e,this.data=t||s||{},s=s||{},this.send(()=>{let e=s.accept||["application/json"];r.accept(e)}),super.init(this.method,this.url,s)}},squire.Html=class extends squire.Get{constructor(){super()}init(e,t){let s=this;return t.accept="html",this.on("send",()=>{s.response.type="document"}),super.init(this.method,e,t)}static html(e,t,s){return(new squire.Html).init(e,t,s)}};