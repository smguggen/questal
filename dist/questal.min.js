const QuestalUtil=class{static getType(e){return e instanceof RegExp?"regex":"object"==typeof e?"object"==typeof obj&&(null==obj?"null":Array.isArray(obj)?"array":"object"):typeof e}static typecheck(e,t){var s;switch(t=t||"string"){case"array":s=Array.isArray(e);break;case"object":s="object"==typeof e&&null!=e&&!Array.isArray(e);break;case"regex":s=e instanceof RegExp;break;case"null":s=!e;case"undefined":case"false":break;case"true":s=!!e;break;default:s=typeof e===t}return!!s}static toCamelCase(e){return(e=e||"").split("-").map((e,t)=>t>0?e.substring(0,1).toUpperCase()+e.substring(1):e).join("").trim()}},QuestalEvents=class{constructor(e,t){this.target=e,this.caller=t||e}on(e,t){e=e.split(" ");let s=this;return e.forEach(e=>{s.target.addEventListener(e,(function(e){let r=e.detail||s.target;t.call(s.caller,r,e)}))}),this}off(e,t){return"function"==typeof t&&t.name&&(t=t.name),this.target.removeEventListener(e,t),this}fire(e,t,s){s=s||{},this.target.dispatchEvent(new CustomEvent(e,{bubbles:s.bubbles||!1,detail:t||s.detail||null,cancelable:s.cancelable||!1,composed:s.composed||!1}))}},QuestalData=class{set data(e){this.setData(e)}set params(e){this.setData(e)}get data(){return this._data||{}}get params(){return this._params||""}setData(e){this._data||(this._data={}),this._params||(this._params="");let t={},s="",r=QuestalUtil.getType(e);"object"==r?(t=e,s=this.parseParamsToString(e)):"string"==r&&(t=this.parseParamsToObject(e),s=e),this._data=Object.assign({},this._data,t),this._params+=s}parseParamsToObject(e){return"?"==(e=e||"").substring(0,1)&&(e=e.substring(1)),e.split("&").reduce((e,t)=>{let s=t.split("=");return e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]),e},{})}parseParamsToString(e,t){return e=e||{},(t?"?":"")+Object.keys(e).reduce((t,s)=>t+=encodeURIComponent(params)+"="+encodeURIComponent(e[s]),"").join("&")}},QuestalHeader=class{constructor(e){this.request=e,this.headers={}}set accept(e){if(this._accept||(this._accept=[]),Array.isArray(e)){if(e.includes("*")||e.includes("*/*"))return void(this._accept=["*/*"]);let t=this;e.forEach(e=>{t._parseAccept(e)})}else{if(["*","*/*"].includes(e))return void(this._accept=["*/*"]);this._parseAccept(e)}}get accept(){return this._accept||(this._accept=[]),this._accept.includes("*/*")?"*/*":this._accept.join(",")}set encoding(e){let t=this;switch(e){case"multipart":t._encoding="multipart/form-data";case"form":break;case"plain":t._encoding="text/plain";break;default:t._encoding="application/x-www-form-urlencoded"}}get encoding(){return this._encoding?this._encoding:"application/x-www-form-urlencoded"}set(e,t){return"accept"==e.toLowerCase()?this.accept=t:"encoding"==e||"Content-Type"==e||"content"==e?this.encoding=t:this.isForbidden(e)||(this.headers[e]=t),this}init(){if(this.sendable){let e=Object.keys(this.headers);for(let t=0;t<e.length;t++){let s=e[t],r=this.headers[s];this.isForbidden(s)||this.request.setRequestHeader(s,r),this.accept&&this.request.setRequestHeader("Accept",this.accept),this.encoding&&this.request.setRequestHeader("Content-Type",this.encoding)}}return this}isForbidden(e){if((e=e.trim()).startsWith("Sec-")||e.startsWith("Proxy-"))return!0;return!!["Accept-Charset","Accept-Encoding","Access-Control-Request-Headers","Access-Control-Request-Method","Connection","Content-Length","Cookie","Cookie2","Date","DNT","Expect","Host","Keep-Alive","Origin","Referer","TE","Trailer","Transfer-Encoding","Upgrade","Via"].includes(e)}sendable(){return!(this.request.readyState>=2)}_parseAccept(e){let t;switch(e){case"json":t="application/json";break;case"html":t="text/html";break;case"xml":t="application/xml, application/xhtml+xml";break;case"plain":t="text/plain";break;default:t=e}this._accept.includes(t)||this._accept.push(t)}},QuestalResponse=class{constructor(e){this.request=e,this.defaultType="text",this.types=["arraybuffer","blob","document","text","json"]}get headers(){let e=this.request.getAllResponseHeaders(),t={};return e&&(t=e.split("\r\n").reduce((e,t)=>{let s=t.split(":");if(s&&2==s.length){let t=QuestalUtil.toCamelCase(s[0]);if(["contentType","cacheControl"].includes(t)){let r="contentType"==t?";":",",i=s[1].split(r),a=i[0].trim();if(e[t]=a,"contentType"==t&&(e.encoding=a.split("/")[1]),i.length>1){let t=i[1].split("=");if(t.length>1){e[QuestalUtil.toCamelCase(t[0])]=t[1].trim()}}}else e[t]=s[1].trim()}return e},{})),this.type&&(t.responseType=this.type),t}get data(){let e=this.type;this.type="json";let t=this.request.response;return this.type=e,t}get url(){return this.request.responseURL}get result(){return this.request.responseText}get json(){let e=this.result;try{return JSON.parse(e)}catch(t){return e}}get xml(){return this.request.responseXML}get html(){return"document"==this.type?this.request.responseXML:""}set type(e){e="buffer"==e?"arraybuffer":e,this.types.includes(e)&&this.request.readyState<2?this.request.responseType=e:console.log("Can't set "+e+". Headers already sent")}get type(){return this.request.responseType}get status(){return this.request.statusText}get code(){return this.request.status}isSuccess(){return 304==this.code?(console.log("Results shown are cached version returned from server."),!0):this.code>=200&&this.code<300}},QuestalRequest=class{constructor(e){this.options=e,this.request=new XMLHttpRequest,this.header=new QuestalHeader(this.request),this.response=new QuestalResponse(this.request),this.events=new QuestalEvents(this.request,this),this.eventNames=["init","ready","responseHeaders","loadStart","change","complete","success","progress","abort","error","timeout"],this.data=new QuestalData,this._init()}set method(e){this._method=e}get method(){return this._method}set url(e){if(!/\.[A-Z0-9\.]{2,}$/i.test(e))return;let t=e.split("?");this._url=t[0],t.length>1&&(this.data.params=t[1])}get url(){return"get"==this.method&&this.data.params?this._url+"?"+this.data.params:this._url}get state(){return["unsent","ready","responseHeaders","loadStart","complete"][this.request.readyState]}set options(e){e=e||{},this._options||(this._options={}),this._options=Object.assign({},this._options,e)}get options(){return this._options||{}}get(e){return this.request[e]}set(e,t){let s=this;switch(e){case"credentials":s.request.withCredentials=t;break;default:s.request[e]=t}return this}open(e,t){return this._presend(e,t),this.request.open(this.method,this.url),this}send(e){if("ready"!=this.state)throw new Error(`Request can\t be sent with a ready state of "${this.state}".`);return this.request.send(e),this}on(e,t){["progress","abort","error","timeout"].includes(e)&&(e="_"+e),this.events.on(e,t)}off(e,t){["progress","abort","error","timeout"].includes(e)&&(e="_"+e),this.events.off(e,t)}abort(){return this.request.abort(),this}onLoad(){let e=this;this.on("load",(function(){e.events.fire("complete",e.response),e.response.isSuccess()&&e.events.fire("success",e.response)}))}onChange(){let e=this;this.on("readystatechange",(function(){switch(e.events.fire("change"),e.state){case"ready":e.events.fire("ready");break;case"responseHeaders":e.events.fire("responseHeaders",e.header);break;case"loadStart":e.events.fire("loadStart")}}))}onReady(){this.on("ready",(function(){this.header.init()}))}_init(){let e=this;this.url=this.options.url,this.method=this.options.method||"get",this.data.params=this.options.data||this.options.params,this.set("timeout",this.options.timeout||6e4);let t=Object.keys(this.options);for(let e=0;e<t.length;e++){let s=t[e];this.eventNames.includes(s)&&this.on(s,this.options[s])}this.onLoad(),this.onChange(),this.on("progress",(function(t){e.events.fire("_progress",t)})),this.on("abort",(function(){e.events.fire("_abort")})),this.on("error",(function(t){e.events.fire("_error",t)})),this.on("timeout",(function(){e.events.fire("_timeout")})),this.onReady()}_presend(e,t){if(e&&(this.url=e),t&&(this.data.params=t),this.events.fire("init"),this.method){if(this.url)return!0;throw new Error("Request Url is invalid")}throw new Error("Request method is empty")}},QuestalGet=class extends QuestalRequest{constructor(){super()}get method(){return"get"}set method(e){}open(){return null}send(e,t){super.open(e,t),super.send()}_onReady(e){let t=this;this.on("ready",()=>{let s=e.accept||["plain","xml","html"];t.header.accept=s,t.header.init()})}},QuestalPost=class extends QuestalRequest{constructor(e){super(e)}get method(){return"post"}set method(e){}open(){return null}send(e,t){super.open(e,t),super.send(this.data.params)}onReady(e){let t=this;this.on("ready",()=>{let s=e.accept||["application/json"];t.header.accept=s,t.header.init()})}},Questal=class extends QuestalRequest{constructor(){super()}static Get(){return new QuestalGet}static Post(){return new QuestalPost}static get(e,t,s,r){"function"==typeof t&&(r=s=t);let i=new QuestalGet({success:s,error:r});return i.on("success",s),i.send(e,t)}static post(e,t,s,r){return"function"==typeof t&&(r=s=t),new QuestalPost({success:s,error:r}).send(e,t)}};