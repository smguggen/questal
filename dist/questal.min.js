"use strict";function _get(t,e,s){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,s){var n=_superPropBase(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(s):r.value}})(t,e,s||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _createSuper(t){return function(){var e,s=_getPrototypeOf(t);if(_isNativeReflectConstruct()){var n=_getPrototypeOf(this).constructor;e=Reflect.construct(s,arguments,n)}else e=s.apply(this,arguments);return _possibleConstructorReturn(this,e)}}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,s){return e&&_defineProperties(t.prototype,e),s&&_defineProperties(t,s),t}var QuestalUtil=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"getType",value:function(t){return t instanceof RegExp?"regex":"object"===_typeof(t)?null==t?"null":Array.isArray(t)?"array":"object":_typeof(t)}},{key:"typecheck",value:function(t,e){var s;switch(e=e||"string"){case"array":s=Array.isArray(t);break;case"object":s="object"===_typeof(t)&&null!=t&&!Array.isArray(t);break;case"regex":s=t instanceof RegExp;break;case"null":s=!t;case"undefined":case"false":break;case"true":s=!!t;break;default:s=_typeof(t)===e}return!!s}},{key:"toCamelCase",value:function(t){return(t=t||"").split("-").map((function(t,e){return e>0?t.substring(0,1).toUpperCase()+t.substring(1):t})).join("").trim()}},{key:"ucfirst",value:function(t){return t&&"string"==typeof t?t.substring(0,1).toUpperCase()+t.substring(1).toLowerCase():t}}]),t}(),QuestalEvents=function(){function t(e,s){_classCallCheck(this,t),this.target=e,this.caller=s||e,this.customExists="undefined"!=typeof CustomEvent}return _createClass(t,[{key:"on",value:function(t,e){t=t.split(" ");var s=this;return t.forEach((function(t){s.target.addEventListener(t,(function(t){var n=t.detail||s.target;e.call(s.caller,n,t)}))})),this}},{key:"off",value:function(t,e){return"function"==typeof e&&e.name&&(e=e.name),this.target.removeEventListener(t,e),this}},{key:"fire",value:function(t,e,s){this.customExists?this._fireCustom(t,e,s):(console.warn("Event Details not available in this browser."),this.target.dispatchEvent(t))}},{key:"_fireCustom",value:function(t,e,s){s=s||{},this.target.dispatchEvent(new CustomEvent(t,{bubbles:s.bubbles||!1,detail:e||s.detail||null,cancelable:s.cancelable||!1,composed:s.composed||!1}))}}]),t}(),QuestalData=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"setData",value:function(t){this._data||(this._data={}),this._params||(this._params="");var e={},s="",n=QuestalUtil.getType(t);"object"==n?(e=t,s=this.parseParamsToString(t)):"string"==n&&(e=this.parseParamsToObject(t),s=t),this._data=Object.assign({},this._data,e),this._params+=s}},{key:"parseParamsToObject",value:function(t){return"?"==(t=t||"").substring(0,1)&&(t=t.substring(1)),t.split("&").reduce((function(t,e){var s=e.split("=");return t[decodeURIComponent(s[0])]=decodeURIComponent(s[1]),t}),{})}},{key:"parseParamsToString",value:function(t,e){return t=t||{},(e?"?":"")+Object.keys(t).map((function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])})).join("&")}},{key:"data",set:function(t){this.setData(t)},get:function(){return this._data||{}}},{key:"params",set:function(t){this.setData(t)},get:function(){return this._params||""}}]),t}(),QuestalHeaders=function(){function t(e){_classCallCheck(this,t),this.settings=e,this.headers={}}return _createClass(t,[{key:"set",value:function(t,e){return"accept"==t.toLowerCase()?this.accept=e:"encoding"==t||"Content-Type"==t||"content"==t?this.encoding=e:this.isForbidden(t)||(this.headers[t]=e),this}},{key:"init",value:function(){if(this.sendable){for(var t=Object.keys(this.headers),e=0;e<t.length;e++){var s=t[e],n=this.headers[s];this.isForbidden(s)||this.settings.setRequestHeader(s,n)}this.accept&&this.settings.setRequestHeader("Accept",this.accept),this.encoding&&this.settings.setRequestHeader("Content-Type",this.encoding)}return this}},{key:"isForbidden",value:function(t){if((t=t.trim()).startsWith("Sec-")||t.startsWith("Proxy-"))return!0;return!!["Accept-Charset","Accept-Encoding","Access-Control-Request-Headers","Access-Control-Request-Method","Connection","Content-Length","Cookie","Cookie2","Date","DNT","Expect","Host","Keep-Alive","Origin","Referer","TE","Trailer","Transfer-Encoding","Upgrade","Via"].includes(t)}},{key:"sendable",value:function(){return!(this.settings.readyState>=2)}},{key:"_parseAccept",value:function(t){var e;switch(t){case"json":e="application/json";break;case"html":e="text/html";break;case"xml":e="application/xml, application/xhtml+xml";break;case"plain":e="text/plain";break;default:e=t}this._accept.includes(e)||this._accept.push(e)}},{key:"accept",set:function(t){if(this._accept||(this._accept=[]),Array.isArray(t)){if(t.includes("*")||t.includes("*/*"))return void(this._accept=["*/*"]);var e=this;t.forEach((function(t){e._parseAccept(t)}))}else{if(["*","*/*"].includes(t))return void(this._accept=["*/*"]);this._parseAccept(t)}},get:function(){return this._accept||(this._accept=[]),this._accept.includes("*/*")?"*/*":this._accept.join(",")}},{key:"encoding",set:function(t){switch(t){case"multipart":this._encoding="multipart/form-data";case"form":break;case"plain":this._encoding="text/plain";break;default:this._encoding="application/x-www-form-urlencoded"}},get:function(){return this._encoding?this._encoding:"application/x-www-form-urlencoded"}}]),t}(),QuestalResponse=function(){function t(e,s){_classCallCheck(this,t),this.hasBody=!s,this.settings=e,this.defaultType="text",this.types=["arraybuffer","blob","document","text","json"]}return _createClass(t,[{key:"isSuccess",value:function(){var t=this.code;return t>=200&&t<300}},{key:"success304",value:function(t){return 304==t&&console.warn("Response Code 304: Server returned cached version of data"),t>=200&&(t<300||304==t)}},{key:"headers",get:function(){var t=this.settings.getAllResponseHeaders(),e={};return t&&(e=t.split("\r\n").reduce((function(t,e){var s=e.split(":");if(s&&2==s.length){var n=QuestalUtil.toCamelCase(s[0]);if(["contentType","cacheControl"].includes(n)){var r="contentType"==n?";":",",i=s[1].split(r),o=i[0].trim();if(t[n]=o,"contentType"==n&&(t.encoding=o.split("/")[1]),i.length>1){var a=i[1].split("=");if(a.length>1)t[QuestalUtil.toCamelCase(a[0])]=a[1].trim()}}else t[n]=s[1].trim()}return t}),{})),this.type&&(e.responseType=this.type),e}},{key:"url",get:function(){return this.settings.responseURL}},{key:"result",get:function(){return this.hasBody?["","text"].includes(this.type)?this.settings.responseText:this.settings.response:this.headers}},{key:"text",get:function(){if(!this.hasBody)return"";var t=this.json;try{return JSON.stringify(t)}catch(e){return t.toString()}}},{key:"json",get:function(){if(!this.hasBody)return[];var t=this.result;try{var e=JSON.parse(t);return"string"==typeof e?JSON.parse(e):e}catch(e){return t}}},{key:"xml",get:function(){return this.hasBody?this.settings.responseXML:""}},{key:"html",get:function(){return this.hasBody&&"document"==this.type?this.settings.responseXML:""}},{key:"type",set:function(t){t="buffer"==t?"arraybuffer":t,this.types.includes(t)&&this.settings.readyState<2?this.settings.responseType=t:this.types.includes(t)?console.error("Can't set "+t+". Headers already sent"):console.error("Type ".concat(t," is not a valid response type"))},get:function(){return this.settings.responseType}},{key:"status",get:function(){return this.settings.statusText}},{key:"code",get:function(){return this.settings.status}}]),t}(),QuestalRequest=function(){function t(e,s){_classCallCheck(this,t),this.options=e||{},this.settings=new XMLHttpRequest,this.headers=new QuestalHeaders(this.settings),this.response=new QuestalResponse(this.settings,s),this.events=new QuestalEvents(this.settings,this),this.eventNames=["init","ready","responseHeaders","loadStart","change","complete","success","progress","abort","error","timeout"],this.data=new QuestalData,this._init()}return _createClass(t,[{key:"get",value:function(t){return this.settings[t]}},{key:"set",value:function(t,e){switch(t){case"credentials":this.settings.withCredentials=e;break;default:this.settings[t]=e}return this}},{key:"open",value:function(t,e){this._presend(t,e);var s=this.method.toUpperCase();return this.settings.open(s,this.url),this}},{key:"send",value:function(t){if("ready"!=this.state)throw new Error('Request can\t be sent with a ready state of "'.concat(this.state,'".'));return this.settings.send(t),this}},{key:"on",value:function(t,e){["progress","abort","error","timeout"].includes(t)&&(t="_"+t),this.events.on(t,e)}},{key:"off",value:function(t,e){["progress","abort","error","timeout"].includes(t)&&(t="_"+t),this.events.off(t,e)}},{key:"abort",value:function(){return this.settings.abort(),this}},{key:"onLoad",value:function(){var t=this;this.on("load",(function(){t.events.fire("complete",t.response),t.success&&t.events.fire("success",t.response)}))}},{key:"onChange",value:function(){var t=this;this.on("readystatechange",(function(){switch(t.events.fire("change"),t.state){case"ready":t.events.fire("ready");break;case"responseHeaders":t.events.fire("responseHeaders",t.response.headers);break;case"loadStart":t.events.fire("loadStart")}}))}},{key:"onReady",value:function(){this.on("ready",(function(){this.headers.init()}))}},{key:"_init",value:function(){var t=this;this.url=this.options.url,this.method=this.options.method||"get",this.data.params=this.options.data||this.options.params,this.set("timeout",this.options.timeout||6e4),this.onLoad(),this.onChange(),this.on("progress",(function(e){t.events.fire("_progress",e)})),this.on("abort",(function(){t.events.fire("_abort")})),this.on("error",(function(e){t.events.fire("_error",e)})),this.on("timeout",(function(){t.events.fire("_timeout")})),this.onReady(),this.setOptions(this.options)}},{key:"setOptions",value:function(t){t=t||{};for(var e=Object.keys(t),s=0;s<e.length;s++){var n=e[s],r=t[n];this.eventNames.includes(n)?this.on(n,r):this.set(n,r)}}},{key:"_presend",value:function(t,e){if(t&&(this.url=t),e&&(this.data.params=e),this.events.fire("init"),this.method){if(this.url)return!0;throw new Error("Request Url is invalid")}throw new Error("Request method is empty")}},{key:"success",set:function(t){"function"==typeof t&&(this._success=t)},get:function(){return"complete"!=!this.state&&(this._success&&"function"==typeof this._success?this._success(this.response.code):this.response.isSuccess())}},{key:"method",set:function(t){t=t||"",this._method=t},get:function(){return this._method||null}},{key:"url",set:function(t){var e=(t=t||"/").split("?");this._url=e[0],e.length>1&&(this.data.params=e[1])},get:function(){return this._url||"/"}},{key:"state",get:function(){return["unsent","ready","responseHeaders","loadStart","complete"][this.settings.readyState]}},{key:"options",set:function(t){t=t||{},this._options||(this._options={}),this._options=Object.assign({},this._options,t)},get:function(){return this._options||{}}}]),t}(),QuestalGet=function(t){_inherits(s,QuestalRequest);var e=_createSuper(s);function s(t){var n;return _classCallCheck(this,s),(n=e.call(this,t)).success=n.response.success304,n}return _createClass(s,[{key:"open",value:function(){return null}},{key:"send",value:function(t,e){_get(_getPrototypeOf(s.prototype),"open",this).call(this,t,e),_get(_getPrototypeOf(s.prototype),"send",this).call(this)}},{key:"_onReady",value:function(t){var e=this;this.on("ready",(function(){var s=t.accept||["plain","xml","html"];e.headers.accept=s,e.headers.init()}))}},{key:"method",get:function(){return"get"},set:function(t){}},{key:"url",set:function(t){var e=(t=t||"/").split("?");this._url=e[0],e.length>1&&(this.data.params=e[1])},get:function(){return this.data.params?this._url+"?"+this.data.params:this._url}}]),s}(),QuestalPost=function(t){_inherits(s,QuestalRequest);var e=_createSuper(s);function s(t){var n;return _classCallCheck(this,s),(n=e.call(this,t)).success=n.response.success304,n}return _createClass(s,[{key:"open",value:function(){return null}},{key:"send",value:function(t,e){_get(_getPrototypeOf(s.prototype),"open",this).call(this,t,e),_get(_getPrototypeOf(s.prototype),"send",this).call(this,this.data.params)}},{key:"onReady",value:function(t){var e=this;t=t||this.options,this.on("ready",(function(){var s=t.accept||["application/json"];e.headers.accept=s,e.headers.init()}))}},{key:"method",get:function(){return"post"},set:function(t){}}]),s}(),QuestalDelete=function(t){_inherits(s,QuestalRequest);var e=_createSuper(s);function s(t){return _classCallCheck(this,s),e.call(this,t)}return _createClass(s,[{key:"open",value:function(){return null}},{key:"send",value:function(t,e){_get(_getPrototypeOf(s.prototype),"open",this).call(this,t,e),_get(_getPrototypeOf(s.prototype),"send",this).call(this)}},{key:"_onReady",value:function(t){var e=this;this.on("ready",(function(){e.headers.init()}))}},{key:"method",get:function(){return"delete"},set:function(t){}},{key:"url",set:function(t){var e=(t=t||"/").split("?");this._url=e[0],e.length>1&&(this.data.params=e[1])},get:function(){return this.data.params?this._url+"?"+this.data.params:this._url}}]),s}(),Questal=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"request",value:function(t,e){if("get"==(t=t?t.toLowerCase():null))return this.get(e);if("post"==t)return this.post(e);var s=new QuestalRequest(e);return s.method=t||null,s}},{key:"get",value:function(t){return new QuestalGet(t)}},{key:"post",value:function(t){return new QuestalPost(t)}},{key:"put",value:function(t,e,s,n){s=this._processOptions(s);var r=this.request("put",s);return n?r:r.open(t,e).send(r.data.params)}},{key:"patch",value:function(t,e,s,n){s=this._processOptions(s);var r=this.request("patch",s);return n?r:r.open(t,e).send(r.data.params)}},{key:"head",value:function(t,e,s){e=this._processOptions(e,"responseHeaders");var n=this.request("head",e);return s?n:n.open(t).send()}},{key:"delete",value:function(t,e,s){e=this._processOptions(e);var n=new QuestalDelete(e);return s?n:e.data?n.send(t,data):n.send(t)}},{key:"_processOptions",value:function(t,e){return e=e||"success","function"==typeof(t=t||{})&&(t[e]=t),t}},{key:"_staticTemplate",value:function(t,e,s,n,r){"function"==typeof s&&(onSuccess=s,onError=onSuccess,s={});var i=this[t];return"function"==typeof i?i(e,s,{success:n,error:r}):null}}],[{key:"Request",value:function(){return new QuestalRequest}},{key:"Get",value:function(t,e,s,n){return"function"==typeof e&&(n=s=e,e={}),new QuestalGet({success:s,error:n}).send(t,e)}},{key:"Post",value:function(t,e,s,n){return"function"==typeof e&&(n=s=e),new QuestalPost({success:s,error:n}).send(t,e)}},{key:"Put",value:function(e,s,n,r){return(new t)._staticTemplate("put",e,s,n,r)}},{key:"Patch",value:function(e,s,n,r){return(new t)._staticTemplate("patch",e,s,n,r)}},{key:"Head",value:function(e,s,n){return(new t).head(e,{success:s,error:n})}},{key:"Delete",value:function(e,s,n){return(new t).delete(e,{success:s,error:n})}}]),t}();