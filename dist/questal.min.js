class QuestalUtil{static getType(t){return t instanceof RegExp?"regex":"object"==typeof t?null==t?"null":Array.isArray(t)?"array":"object":typeof t}static typecheck(t,e){var s;switch(e=e||"string"){case"array":s=Array.isArray(t);break;case"object":s="object"==typeof t&&null!=t&&!Array.isArray(t);break;case"regex":s=t instanceof RegExp;break;case"null":s=!t;case"undefined":case"false":break;case"true":s=!!t;break;default:s=typeof t===e}return!!s}static toCamelCase(t){return(t=t||"").split("-").map((t,e)=>e>0?t.substring(0,1).toUpperCase()+t.substring(1):t).join("").trim()}static ucfirst(t){return t&&"string"==typeof t?t.substring(0,1).toUpperCase()+t.substring(1).toLowerCase():t}}class QuestalEvents{constructor(t,e){this.target=t,this.caller=e||t,this.customExists="undefined"!=typeof CustomEvent}on(t,e){t=t.split(" ");let s=this;return t.forEach(t=>{s.target.addEventListener(t,(function(t){let r=t.detail||s.target;e.call(s.caller,r,t)}))}),this}off(t,e){return"function"==typeof e&&e.name&&(e=e.name),this.target.removeEventListener(t,e),this}fire(t,e,s){this.customExists?this._fireCustom(t,e,s):(console.warning("Event Details not available in this browser."),this.target.dispatchEvent(t))}_fireCustom(t,e,s){s=s||{},this.target.dispatchEvent(new CustomEvent(t,{bubbles:s.bubbles||!1,detail:e||s.detail||null,cancelable:s.cancelable||!1,composed:s.composed||!1}))}}class QuestalData{set data(t){this.setData(t)}set params(t){this.setData(t)}get data(){return this._data||{}}get params(){return this._params||""}setData(t){this._data||(this._data={}),this._params||(this._params="");let e={},s="",r=QuestalUtil.getType(t);"object"==r?(e=t,s=this.parseParamsToString(t)):"string"==r&&(e=this.parseParamsToObject(t),s=t),this._data=Object.assign({},this._data,e),this._params+=s}parseParamsToObject(t){return"?"==(t=t||"").substring(0,1)&&(t=t.substring(1)),t.split("&").reduce((t,e)=>{let s=e.split("=");return t[decodeURIComponent(s[0])]=decodeURIComponent(s[1]),t},{})}parseParamsToString(t,e){return t=t||{},(e?"?":"")+Object.keys(t).map(e=>encodeURIComponent(e)+"="+encodeURIComponent(t[e])).join("&")}}class QuestalHeaders{constructor(t){this.settings=t,this.headers={}}set accept(t){if(this._accept||(this._accept=[]),Array.isArray(t)){if(t.includes("*")||t.includes("*/*"))return void(this._accept=["*/*"]);let e=this;t.forEach(t=>{e._parseAccept(t)})}else{if(["*","*/*"].includes(t))return void(this._accept=["*/*"]);this._parseAccept(t)}}get accept(){return this._accept||(this._accept=[]),this._accept.includes("*/*")?"*/*":this._accept.join(",")}set encoding(t){let e=this;switch(t){case"multipart":e._encoding="multipart/form-data";case"form":break;case"plain":e._encoding="text/plain";break;default:e._encoding="application/x-www-form-urlencoded"}}get encoding(){return this._encoding?this._encoding:"application/x-www-form-urlencoded"}set(t,e){return"accept"==t.toLowerCase()?this.accept=e:"encoding"==t||"Content-Type"==t||"content"==t?this.encoding=e:this.isForbidden(t)||(this.headers[t]=e),this}init(){if(this.sendable){let t=Object.keys(this.headers);for(let e=0;e<t.length;e++){let s=t[e],r=this.headers[s];this.isForbidden(s)||this.settings.setRequestHeader(s,r)}this.accept&&this.settings.setRequestHeader("Accept",this.accept),this.encoding&&this.settings.setRequestHeader("Content-Type",this.encoding)}return this}isForbidden(t){if((t=t.trim()).startsWith("Sec-")||t.startsWith("Proxy-"))return!0;return!!["Accept-Charset","Accept-Encoding","Access-Control-Request-Headers","Access-Control-Request-Method","Connection","Content-Length","Cookie","Cookie2","Date","DNT","Expect","Host","Keep-Alive","Origin","Referer","TE","Trailer","Transfer-Encoding","Upgrade","Via"].includes(t)}sendable(){return!(this.settings.readyState>=2)}_parseAccept(t){let e;switch(t){case"json":e="application/json";break;case"html":e="text/html";break;case"xml":e="application/xml, application/xhtml+xml";break;case"plain":e="text/plain";break;default:e=t}this._accept.includes(e)||this._accept.push(e)}}class QuestalResponse{constructor(t,e){this.hasBody=!e,this.settings=t,this.defaultType="text",this.types=["arraybuffer","blob","document","text","json"]}get headers(){let t=this.settings.getAllResponseHeaders(),e={};return t&&(e=t.split("\r\n").reduce((t,e)=>{let s=e.split(":");if(s&&2==s.length){let e=QuestalUtil.toCamelCase(s[0]);if(["contentType","cacheControl"].includes(e)){let r="contentType"==e?";":",",i=s[1].split(r),n=i[0].trim();if(t[e]=n,"contentType"==e&&(t.encoding=n.split("/")[1]),i.length>1){let e=i[1].split("=");if(e.length>1){t[QuestalUtil.toCamelCase(e[0])]=e[1].trim()}}}else t[e]=s[1].trim()}return t},{})),this.type&&(e.responseType=this.type),e}get url(){return this.settings.responseURL}get result(){return this.hasBody?["","text"].includes(this.type)?this.settings.responseText:this.settings.response:this.headers}get text(){if(!this.hasBody)return"";{let t=this.json;try{return JSON.stringify(t)}catch(e){return t.toString()}}}get json(){if(!this.hasBody)return[];{let t=this.result;try{let e=JSON.parse(t);return"string"==typeof e?JSON.parse(e):e}catch(e){return t}}}get xml(){return this.hasBody?this.settings.responseXML:""}get html(){return this.hasBody&&"document"==this.type?this.settings.responseXML:""}set type(t){t="buffer"==t?"arraybuffer":t,this.types.includes(t)&&this.settings.readyState<2?this.settings.responseType=t:this.types.includes(t)?console.error("Can't set "+t+". Headers already sent"):console.error(`Type ${t} is not a valid response type`)}get type(){return this.settings.responseType}get status(){return this.settings.statusText}get code(){return this.settings.status}isSuccess(){let t=this.code;return t>=200&&t<300}success304(t){return 304==t&&console.warn("Response Code 304: Server returned cached version of data"),t>=200&&(t<300||304==t)}}class QuestalRequest{constructor(t,e){this.options=t||{},this.settings=new XMLHttpRequest,this.headers=new QuestalHeaders(this.settings),this.response=new QuestalResponse(this.settings,e),this.events=new QuestalEvents(this.settings,this),this.eventNames=["init","ready","responseHeaders","loadStart","change","complete","success","progress","abort","error","timeout"],this.data=new QuestalData,this._init()}set success(t){"function"==typeof t&&(this._success=t)}get success(){return"complete"!=!this.state&&(this._success&&"function"==typeof this._success?this._success(this.response.code):this.response.isSuccess())}set method(t){t=t||"",this._method=t}get method(){return this._method||null}set url(t){let e=(t=t||"/").split("?");this._url=e[0],e.length>1&&(this.data.params=e[1])}get url(){return this._url||"/"}get state(){return["unsent","ready","responseHeaders","loadStart","complete"][this.settings.readyState]}set options(t){t=t||{},this._options||(this._options={}),this._options=Object.assign({},this._options,t)}get options(){return this._options||{}}get(t){return this.settings[t]}set(t,e){let s=this;switch(t){case"credentials":s.settings.withCredentials=e;break;default:s.settings[t]=e}return this}open(t,e){this._presend(t,e);let s=this.method.toUpperCase();return this.settings.open(s,this.url),this}send(t){if("ready"!=this.state)throw new Error(`Request can\t be sent with a ready state of "${this.state}".`);return this.settings.send(t),this}on(t,e){["progress","abort","error","timeout"].includes(t)&&(t="_"+t),this.events.on(t,e)}off(t,e){["progress","abort","error","timeout"].includes(t)&&(t="_"+t),this.events.off(t,e)}abort(){return this.settings.abort(),this}onLoad(){let t=this;this.on("load",(function(){t.events.fire("complete",t.response),t.success&&t.events.fire("success",t.response)}))}onChange(){let t=this;this.on("readystatechange",(function(){switch(t.events.fire("change"),t.state){case"ready":t.events.fire("ready");break;case"responseHeaders":t.events.fire("responseHeaders",t.response.headers);break;case"loadStart":t.events.fire("loadStart")}}))}onReady(){this.on("ready",(function(){this.headers.init()}))}_init(){let t=this;this.url=this.options.url,this.method=this.options.method||"get",this.data.params=this.options.data||this.options.params,this.set("timeout",this.options.timeout||6e4),this.onLoad(),this.onChange(),this.on("progress",(function(e){t.events.fire("_progress",e)})),this.on("abort",(function(){t.events.fire("_abort")})),this.on("error",(function(e){t.events.fire("_error",e)})),this.on("timeout",(function(){t.events.fire("_timeout")})),this.onReady(),this.setOptions(this.options)}setOptions(t){t=t||{};let e=Object.keys(t);for(let s=0;s<e.length;s++){let r=e[s],i=t[r];this.eventNames.includes(r)?this.on(r,i):this.set(r,i)}}_presend(t,e){if(t&&(this.url=t),e&&(this.data.params=e),this.events.fire("init"),this.method){if(this.url)return!0;throw new Error("Request Url is invalid")}throw new Error("Request method is empty")}}class QuestalGet extends QuestalRequest{constructor(t){super(t),this.success=this.response.success304}get method(){return"get"}set method(t){}set url(t){let e=(t=t||"/").split("?");this._url=e[0],e.length>1&&(this.data.params=e[1])}get url(){return this.data.params?this._url+"?"+this.data.params:this._url}open(){return null}send(t,e){super.open(t,e),super.send()}_onReady(t){let e=this;this.on("ready",()=>{let s=t.accept||["plain","xml","html"];e.headers.accept=s,e.headers.init()})}}class QuestalPost extends QuestalRequest{constructor(t){super(t),this.success=this.response.success304}get method(){return"post"}set method(t){}open(){return null}send(t,e){super.open(t,e),super.send(this.data.params)}onReady(t){let e=this;t=t||this.options,this.on("ready",()=>{let s=t.accept||["application/json"];e.headers.accept=s,e.headers.init()})}}class QuestalDelete extends QuestalRequest{constructor(t){super(t)}get method(){return"delete"}set method(t){}set url(t){let e=(t=t||"/").split("?");this._url=e[0],e.length>1&&(this.data.params=e[1])}get url(){return this.data.params?this._url+"?"+this.data.params:this._url}open(){return null}send(t,e){super.open(t,e),super.send()}_onReady(t){let e=this;this.on("ready",()=>{e.headers.init()})}}class Questal{request(t,e){if("get"==(t=t?t.toLowerCase():null))return this.get(e);if("post"==t)return this.post(e);{let s=new QuestalRequest(e);return s.method=t||null,s}}get(t){return new QuestalGet(t)}post(t){return new QuestalPost(t)}static Request(){return new QuestalRequest}static Get(t,e,s,r){return"function"==typeof e&&(r=s=e,e={}),new QuestalGet({success:s,error:r}).send(t,e)}static Post(t,e,s,r){return"function"==typeof e&&(r=s=e),new QuestalPost({success:s,error:r}).send(t,e)}_processOptions(t,e){return e=e||"success","function"==typeof(t=t||{})&&(t[e]=t),t}}Questal.prototype.put=function(t,e,s,r){s=this._processOptions(s);let i=this.request("put",s);return r?i:i.open(t,e).send(i.data.params)},Questal.prototype.patch=function(t,e,s,r){s=this._processOptions(s);let i=this.request("patch",s);return r?i:i.open(t,e).send(i.data.params)},Questal.prototype.head=function(t,e,s){e=this._processOptions(e,"responseHeaders");let r=this.request("head",e);return s?r:r.open(t).send()},Questal.prototype.delete=function(t,e,s){e=this._processOptions(e);let r=new QuestalDelete(e);return s?r:e.data?r.send(t,data):r.send(t)};