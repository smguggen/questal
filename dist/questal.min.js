const QuestalUtil=class{static getType(e){return e instanceof RegExp?"regex":"object"==typeof e?"object"==typeof obj&&(null==obj?"null":Array.isArray(obj)?"array":"object"):typeof e}static typecheck(e,t){var s;switch(t=t||"string"){case"array":s=Array.isArray(e);break;case"object":s="object"==typeof e&&null!=e&&!Array.isArray(e);case"regex":s=e instanceof RegExp;break;case"null":s=!e;case"undefined":case"false":break;case"true":s=!!e;break;default:s=typeof e===t}return!!s}},QuestalEvents=class{constructor(e){e=e||[],this.eventNames=e,this.events=this.eventNames.reduce((e,t)=>(e[t]=[],e),{})}on(e,t){return this.event=e,this.events[e].push(t),this}fire(e,...t){let s=this;if(t=t&&t.length?t:null,!this.events[e]||!this.events[e].length)return;let r=this.events[e];for(let e=0;e<r.length;e++){let n=r[e];t?n.apply(s,t):n.call(s)}return this}set event(e){this.eventNames.includes(e)||this.eventNames.push(e),this.events[e]||(this.events[e]=[])}schedule(e,...t){let s=this;return!!(this.eventNames.includes(e)&&this.events[e]&&this.events[e].length)&&((...r)=>{r=r.concat(t),s.fire(e,...r)})}},QuestalData=class{set data(e){this.setData(e)}set params(e){this.setData(e)}get data(){return this._data||{}}get params(){return this._params||""}setData(e){this._data||(this._data={}),this._params||(this._params="");let t={},s="",r=QuestalUtil.getType(e);"object"==r?(t=e,s=this.parseParamsToString(e)):"string"==r&&(t=this.parseParamsToObject(e),s=e),this._data=Object.assign({},this._data,t),this._params+=s}parseParamsToObject(e){return"?"==(e=e||"").substring(0,1)&&(e=e.substring(1)),e.split("&").reduce((e,t)=>{let s=t.split("=");return e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]),e},{})}parseParamsToString(e,t){return e=e||{},(t?"?":"")+Object.keys(e).reduce((t,s)=>t+=encodeURIComponent(params)+"="+encodeURIComponent(e[s]),"").join("&")}},QuestalHeader=class{constructor(e){this.sender=e,this.headers={}}set accept(e){let t;switch(this._accept||(this._accept=[]),e){case"json":t="application/json";break;case"html":t="text/html";break;case"xml":t="application/xml, application/xhtml+xml";break;case"plain":t="text/plain";break;default:t=e}"*/*"==t?this._accept=["*/*"]:this._accept.includes(t)||this._accept.push(t)}get accept(){return this._accept||(this._accept=[]),this._accept.includes("*/*")?"*/*":this._accept.join(",")}set encoding(e){let t=this;switch(e){case"multipart":t.encoding="multipart/form-data";case"form":break;case"plain":t.encoding="text/plain";break;default:t.encoding="application/x-www-form-urlencoded"}}get encoding(){return this._encoding?this._encoding:"application/x-www-form-urlencoded"}set(e,t){return"accept"==e.toLowerCase()?this.accept=t:"encoding"==e||"Content-Type"==e?this.encoding=t:this.isForbidden(e)||(this.headers[e]=t),this}init(){let e=Object.keys(this.headers);for(let t=0;t<e.length;t++){let s=e[t],r=this.headers[s];this.isForbidden(s)||this.sender.setRequestHeader(s,r),this.accept&&this.sender.setRequestHeader("Accept",this.accept),this.encoding&&this.sender.setRequestHeader("Content-Type",this.encoding)}return this}isForbidden(e){if((e=e.trim()).startsWith("Sec-")||e.startsWith("Proxy-"))return!0;return!!["Accept-Charset","Accept-Encoding","Access-Control-Request-Headers","Access-Control-Request-Method","Connection","Content-Length","Cookie","Cookie2","Date","DNT","Expect","Host","Keep-Alive","Origin","Referer","TE","Trailer","Transfer-Encoding","Upgrade","Via"].includes(e)}},QuestalResponse=class{constructor(e){this.sender=e,this.defaultType="text",this.types=["arraybuffer","blob","document","text","json"]}get data(){let e=this.type;this.type="json";let t=this.sender.response;return this.type=e,t}get url(){return this.sender.responseURL}get result(){return this.sender.responseText}get json(){let e=this.result;try{return JSON.parse(e)}catch(t){return e}}get xml(){return this.sender.responseXML}get html(){return"document"==this.type?this.sender.responseXML:""}set type(e){e="buffer"==e?"arraybuffer":e,this.types.includes(e)&&this.sender.readyState<3&&(this.sender.responseType=e)}get type(){return this.sender.responseType}get status(){return this.sender.statusText}get code(){return this.sender.status}isSuccess(){return this.code>=200&&this.code<300}},QuestalRequest=class{constructor(){this.sender=new XMLHttpRequest,this.events=new QuestalEvents(["init","send","change","complete","success","progress","abort","error","timeout"]),this.header=new QuestalHeader(this.sender),this.response=new QuestalResponse(this.sender),this._data=new QuestalData,this.onComplete()}set url(e){if(!QuestalUtil.typecheck(e))return;let t=e.split("?");this._url=t[0],t.length>1&&(this.data=t[1])}get url(){return this._url}get state(){return["unsent","opened","headers_received","loading","done"][this.sender.readyState]}set data(e){this._data.data=e}get data(){return this._data.data}get params(){return this._data.params}abort(){return this.sender.abort(),this}get(e){return this.sender[e]}set(e,t){let s=this;switch(e){case"credentials":s.sender.withCredentials=t;break;default:s.sender[e]=t}return this}on(e,t){this.events.eventNames.includes(e)&&this.events.on(e,t)}init(e,t,s,r){"function"==typeof(s=s||{})&&(s={success:s},"function"==typeof r&&(s.error=r));let n=Object.keys(s);for(let e=0;e<n.length;e++){let t=n[e];this.events.eventNames.includes(t)&&this.on(t,s[t])}this.events.fire("init"),this.set("timeout",s.timeout||6e4);let i=this.events.schedule("complete"),a=this.events.schedule("progress"),c=this.events.schedule("change"),h=this.events.schedule("error"),o=this.events.schedule("abort"),u=this.events.schedule("timeout");return i&&this.set("onload",i),a&&this.set("onprogress",a),c&&this.set("onreadystatechange",c),h&&this.set("onerror",h),o&&this.set("onabort",o),u&&this.set("ontimeout",u),this.sender.open(e,t),this.events.fire("send",this.sender),this.sender.send(),this}onComplete(){let e=this;this.on("complete",t=>{e.response.isSuccess()&&e.events.fire("success",e.response)})}accept(e){if(e&&!/\*\s?\/\s?\*/.test(e)||(e="*/*"),Array.isArray(e)||(e=[e]),e=e.map(e=>{if(["jpeg","jpg","png","gif"].includes(e))return"image/"+e;if(["mp4","mpeg","ogg","3gpp","quicktime"].includes(e))return"video/"+e;switch(e){case"html":return"text/html";case"json":return"application/json";case"xml":return"application/xml";default:return e}}).join(","),"opened"==this.state)this.sender.setRequestHeader("Accept",e);else if("unsent"==this.state){let t=this;this.on("send",()=>{t.sender.setRequestHeader("Accept",e)})}}},QuestalGet=class extends QuestalRequest{constructor(){super()}get method(){return"get"}set method(e){}init(e,t){let s=this;t=t||{},this.url=e,this.data=t.data||{};let r=this.params?e+"?"+this.params:e;return this.on("send",()=>{let e=t.accept||["plain","xml","html"];s.header.accept=e,s.header.init()}),super.init(this.method,r,t)}},QuestalPost=class extends QuestalRequest{constructor(){super()}get method(){return"post"}set method(e){}init(e,t,s,r){let n=this;return this.url=e,this.data=t||s||{},s=s||{},this.on("send",()=>{let e=s.accept||["application/json"];n.accept(e)}),super.init(this.method,this.url,s,r)}},Questal=class extends QuestalRequest{constructor(){super()}get Get(){return new QuestalGet}get Post(){return new QuestalPost}static get(e,t,s,r){return(new QuestalGet).init(e,t,s,r)}static post(e,t,s,r){return(new QuestalPost).init(e,t,s,r)}};