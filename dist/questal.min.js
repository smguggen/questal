const QuestalUtil=class{static getType(e){return e instanceof RegExp?"regex":"object"==typeof e?"object"==typeof obj&&(null==obj?"null":Array.isArray(obj)?"array":"object"):typeof e}static typecheck(e,t){var s;switch(t=t||"string"){case"array":s=Array.isArray(e);break;case"object":s="object"==typeof e&&null!=e&&!Array.isArray(e);case"regex":s=e instanceof RegExp;break;case"null":s=!e;case"undefined":case"false":break;case"true":s=!!e;break;default:s=typeof e===t}return!!s}static toCamelCase(e){return(e=e||"").split("-").map((e,t)=>t>0?e.substring(0,1).toUpperCase()+e.substring(1):e).join("").trim()}},QuestalData=class{set data(e){this.setData(e)}set params(e){this.setData(e)}get data(){return this._data||{}}get params(){return this._params||""}setData(e){this._data||(this._data={}),this._params||(this._params="");let t={},s="",r=QuestalUtil.getType(e);"object"==r?(t=e,s=this.parseParamsToString(e)):"string"==r&&(t=this.parseParamsToObject(e),s=e),this._data=Object.assign({},this._data,t),this._params+=s}parseParamsToObject(e){return"?"==(e=e||"").substring(0,1)&&(e=e.substring(1)),e.split("&").reduce((e,t)=>{let s=t.split("=");return e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]),e},{})}parseParamsToString(e,t){return e=e||{},(t?"?":"")+Object.keys(e).reduce((t,s)=>t+=encodeURIComponent(params)+"="+encodeURIComponent(e[s]),"").join("&")}},QuestalHeader=class{constructor(e){this.sender=e,this.headers={}}set accept(e){if(this._accept||(this._accept=[]),Array.isArray(e)){if(e.includes("*")||e.includes("*/*"))return void(this._accept=["*/*"]);let t=this;e.forEach(e=>{t._parseAccept(e)})}else{if(["*","*/*"].includes(e))return void(this._accept=["*/*"]);this._parseAccept(e)}}get accept(){return this._accept||(this._accept=[]),this._accept.includes("*/*")?"*/*":this._accept.join(",")}set encoding(e){let t=this;switch(e){case"multipart":t._encoding="multipart/form-data";case"form":break;case"plain":t._encoding="text/plain";break;default:t._encoding="application/x-www-form-urlencoded"}}get encoding(){return this._encoding?this._encoding:"application/x-www-form-urlencoded"}set(e,t){return"accept"==e.toLowerCase()?this.accept=t:"encoding"==e||"Content-Type"==e||"content"==e?this.encoding=t:this.isForbidden(e)||(this.headers[e]=t),this}init(){if(this.sendable){let e=Object.keys(this.headers);for(let t=0;t<e.length;t++){let s=e[t],r=this.headers[s];this.isForbidden(s)||this.sender.setRequestHeader(s,r),this.accept&&this.sender.setRequestHeader("Accept",this.accept),this.encoding&&this.sender.setRequestHeader("Content-Type",this.encoding)}}return this}isForbidden(e){if((e=e.trim()).startsWith("Sec-")||e.startsWith("Proxy-"))return!0;return!!["Accept-Charset","Accept-Encoding","Access-Control-Request-Headers","Access-Control-Request-Method","Connection","Content-Length","Cookie","Cookie2","Date","DNT","Expect","Host","Keep-Alive","Origin","Referer","TE","Trailer","Transfer-Encoding","Upgrade","Via"].includes(e)}sendable(){return!(this.sender.readyState>=2)}_parseAccept(e){let t;switch(e){case"json":t="application/json";break;case"html":t="text/html";break;case"xml":t="application/xml, application/xhtml+xml";break;case"plain":t="text/plain";break;default:t=e}this._accept.includes(t)||this._accept.push(t)}},QuestalResponse=class{constructor(e){this.sender=e,this.defaultType="text",this.types=["arraybuffer","blob","document","text","json"]}get headers(){let e=this.sender.getAllResponseHeaders(),t={};return e&&(t=e.split("\r\n").reduce((e,t)=>{let s=t.split(":");if(s&&2==s.length){let t=QuestalUtil.toCamelCase(s[0]);if(["contentType","cacheControl"].includes(t)){let r="contentType"==t?";":",",a=s[1].split(r),n=a[0].trim();if(e[t]=n,"contentType"==t&&(e.encoding=n.split("/")[1]),a.length>1){let t=a[1].split("=");if(t.length>1){e[QuestalUtil.toCamelCase(t[0])]=t[1].trim()}}}else e[t]=s[1].trim()}return e},{})),this.type&&(t.responseType=this.type),t}get data(){let e=this.type;this.type="json";let t=this.sender.response;return this.type=e,t}get url(){return this.sender.responseURL}get result(){return this.sender.responseText}get json(){let e=this.result;try{return JSON.parse(e)}catch(t){return e}}get xml(){return this.sender.responseXML}get html(){return"document"==this.type?this.sender.responseXML:""}set type(e){e="buffer"==e?"arraybuffer":e,this.types.includes(e)&&this.sender.readyState<2?this.sender.responseType=e:console.log("Can't set "+e+". Headers already sent")}get type(){return this.sender.responseType}get status(){return this.sender.statusText}get code(){return this.sender.status}isSuccess(){return this.code>=200&&this.code<300}},QuestalRequest=class{constructor(){this.sender=new XMLHttpRequest,this.events=["init","ready","responseHeaders","loadStart","change","complete","success","progress","abort","error","timeout"],this.header=new QuestalHeader(this.sender),this.response=new QuestalResponse(this.sender),this._data=new QuestalData,this._setEvents()}set url(e){if(!QuestalUtil.typecheck(e))return;let t=e.split("?");this._url=t[0],t.length>1&&(this.data=t[1])}get url(){return this._url}get state(){return["unsent","ready","responseHeaders","loadStart","complete"][this.sender.readyState]}set data(e){this._data.data=e}get data(){return this._data.data}get params(){return this._data.params}abort(){return this.sender.abort(),this}get(e){return this.sender[e]}set(e,t){let s=this;switch(e){case"credentials":s.sender.withCredentials=t;break;default:s.sender[e]=t}return this}on(e,t){let s=this;this.sender.addEventListener(e,(function(e){let r=e.detail||s.sender;t.call(s,r,e)}))}fire(e,t,s){s=s||{},this.sender.dispatchEvent(new CustomEvent(e,{bubbles:s.bubbles||!1,detail:t||s.detail||null,cancelable:s.cancelable||!1,composed:s.composed||!1}))}init(e,t,s,r){"function"==typeof(s=s||{})&&(s={success:s},"function"==typeof r&&(s.error=r));let a=Object.keys(s);for(let e=0;e<a.length;e++){let t=a[e];this.events.includes(t)&&this.on(t,s[t])}return this.fire("init"),this.set("timeout",s.timeout||6e4),this.sender.open(e,t),this}send(e){e=e||null,this.sender.send(e)}_onChange(){let e=this;this.on("readystatechange",()=>{switch(e.type){case"ready":e.fire("ready");break;case"responseHeaders":e.fire("responseHeaders",e.header);break;case"loadStart":e.fire("loadStart")}})}_onReady(){let e=this;this.on("ready",()=>{e.header.init()})}_onComplete(){let e=this;this.on("load",t=>{e.response.isSuccess()&&e.fire("success",e.response)})}_setEvents(){this.schedule("load","complete",this.response),this.schedule("readystatechange","change"),this._onChange(),this._onReady(),this._onComplete()}schedule(e,t,s){let r=this;this.on(e,(function(){r.fire(t,s)}))}},QuestalGet=class extends QuestalRequest{constructor(){super()}get method(){return"get"}set method(e){}send(e,t){t=t||{},this.url=e,this.data=t.data||{};let s=this.params?e+"?"+this.params:e;this.init(this.method,s,t),super.send()}_onReady(){let e=this;this.on("ready",()=>{let t=options.accept||["plain","xml","html"];e.header.accept=t,e.header.init()})}},QuestalPost=class extends QuestalRequest{constructor(){super()}get method(){return"post"}set method(e){}send(e,t,s,r){this.url=e,this.data=t||s||{},s=s||{},this.init(this.method,this.url,s,r),super.send(this.params)}_onReady(){let e=this;this.on("ready",()=>{let t=options.accept||["application/json"];e.header.accept=t,e.header.init()})}},Questal=class extends QuestalRequest{constructor(){super()}static Get(){return new QuestalGet}static Post(){return new QuestalPost}static get(e,t,s,r){return(new QuestalGet).send(e,t,s,r)}static post(e,t,s,r){return(new QuestalPost).send(e,t,s,r)}};